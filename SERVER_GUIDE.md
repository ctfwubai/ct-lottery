# æŠ½å¥–ç³»ç»ŸæœåŠ¡ç®¡ç†æŒ‡å—

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨ `server.sh`ï¼ˆUbuntu/Linuxï¼‰å’Œ `server.bat`ï¼ˆWindowsï¼‰è„šæœ¬æ¥ç®¡ç†æŠ½å¥–ç³»ç»Ÿçš„å‰åç«¯æœåŠ¡ã€‚

---

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### Ubuntu/Linux ä½¿ç”¨æ–¹æ³•

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x /opt/log-lottery-main/server.sh

# å¯åŠ¨æœåŠ¡
./server.sh start

# æˆ–è€…ä½¿ç”¨äº¤äº’å¼èœå•
./server.sh
```

### Windows ä½¿ç”¨æ–¹æ³•

```batch
# åŒå‡»è¿è¡Œ
server.bat

# æˆ–åœ¨å‘½ä»¤è¡Œè¿è¡Œ
cd D:\ftp\choujiang\log-lottery-main
server.bat
```

---

## ğŸ® åŠŸèƒ½è¯´æ˜

### Ubuntu/Linux (server.sh)

#### å‘½ä»¤è¡Œæ¨¡å¼

```bash
# å¯åŠ¨æœåŠ¡
./server.sh start

# åœæ­¢æœåŠ¡
./server.sh stop

# é‡å¯æœåŠ¡
./server.sh restart

# æŸ¥çœ‹çŠ¶æ€
./server.sh status

# æŸ¥çœ‹æ—¥å¿—
./server.sh logs

# é‡æ–°éƒ¨ç½²ï¼ˆæ„å»º+éƒ¨ç½²+å¯åŠ¨ï¼‰
./server.sh redeploy

# æ˜¾ç¤ºå¸®åŠ©
./server.sh help
```

#### äº¤äº’å¼èœå•

è¿è¡Œ `./server.sh` åï¼Œä¼šæ˜¾ç¤ºèœå•ï¼š

```
==========================================
æŠ½å¥–ç³»ç»ŸæœåŠ¡ç®¡ç†
==========================================

1) å¯åŠ¨æœåŠ¡
2) åœæ­¢æœåŠ¡
3) é‡å¯æœåŠ¡
4) æŸ¥çœ‹çŠ¶æ€
5) æŸ¥çœ‹æ—¥å¿—
6) é‡æ–°éƒ¨ç½²
7) é€€å‡º
```

### Windows (server.bat)

åŒå‡»è¿è¡Œ `server.bat` åï¼Œä¼šæ˜¾ç¤ºäº¤äº’å¼èœå•ï¼š

```
==========================================
æŠ½å¥–ç³»ç»ŸæœåŠ¡ç®¡ç† (Windows)
==========================================

1) å¯åŠ¨æœåŠ¡
2) åœæ­¢æœåŠ¡
3) é‡å¯æœåŠ¡
4) æŸ¥çœ‹çŠ¶æ€
5) æŸ¥çœ‹æ—¥å¿—
6) æ„å»ºå¹¶éƒ¨ç½²
7) é€€å‡º
```

---

## ğŸ” è¯¦ç»†åŠŸèƒ½è¯´æ˜

### 1. å¯åŠ¨æœåŠ¡

**Ubuntu/Linux:**
- å¯åŠ¨ Nginxï¼ˆå‰ç«¯æœåŠ¡ï¼‰
- å¯åŠ¨ PM2 åç«¯æœåŠ¡
- æ˜¾ç¤ºè®¿é—®åœ°å€

**Windows:**
- å¯åŠ¨åç«¯æœåŠ¡ (server.cjs)
- å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ (npm run dev:fe)
- æ˜¾ç¤ºè®¿é—®åœ°å€

### 2. åœæ­¢æœåŠ¡

**Ubuntu/Linux:**
- åœæ­¢ PM2 åç«¯æœåŠ¡
- åœæ­¢ Nginx æœåŠ¡

**Windows:**
- åœæ­¢ PM2 åç«¯æœåŠ¡ï¼ˆå¦‚æœä½¿ç”¨ PM2ï¼‰
- æˆ–åœæ­¢æ‰€æœ‰ node.exe è¿›ç¨‹

### 3. é‡å¯æœåŠ¡

**Ubuntu/Linux:**
- å…ˆåœæ­¢æ‰€æœ‰æœåŠ¡
- å†å¯åŠ¨æ‰€æœ‰æœåŠ¡

**Windows:**
- å…ˆåœæ­¢æ‰€æœ‰æœåŠ¡
- å†å¯åŠ¨æ‰€æœ‰æœåŠ¡

### 4. æŸ¥çœ‹çŠ¶æ€

æ˜¾ç¤ºä»¥ä¸‹ä¿¡æ¯ï¼š
- PM2 åç«¯æœåŠ¡çŠ¶æ€
- Nginx çŠ¶æ€ï¼ˆä»… Linuxï¼‰
- ç«¯å£å ç”¨æƒ…å†µ
- æœåŠ¡è¿›ç¨‹ä¿¡æ¯

### 5. æŸ¥çœ‹æ—¥å¿—

**Ubuntu/Linux æ—¥å¿—é€‰é¡¹:**
```
é€‰æ‹©è¦æŸ¥çœ‹çš„æ—¥å¿—:
1) åç«¯æœåŠ¡æ—¥å¿— (PM2)
2) Nginx è®¿é—®æ—¥å¿—
3) Nginx é”™è¯¯æ—¥å¿—
4) å®æ—¶æŸ¥çœ‹åç«¯æ—¥å¿—
5) å®æ—¶æŸ¥çœ‹ Nginx è®¿é—®æ—¥å¿—
6) å®æ—¶æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
0) è¿”å›
```

**Windows æ—¥å¿—é€‰é¡¹:**
```
é€‰æ‹©è¦æŸ¥çœ‹çš„æ—¥å¿—:
1) PM2 åç«¯æ—¥å¿—
2) PM2 é”™è¯¯æ—¥å¿—
3) è¿”å›
```

### 6. é‡æ–°éƒ¨ç½² (Ubuntu/Linux)

æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
1. åœæ­¢æœåŠ¡
2. å®‰è£…ä¾èµ–
3. æ„å»ºé¡¹ç›®
4. éƒ¨ç½²åˆ° Nginx
5. è®¾ç½®æƒé™
6. å¯åŠ¨æœåŠ¡

### 6. æ„å»ºå¹¶éƒ¨ç½² (Windows)

æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
1. å®‰è£…ä¾èµ–
2. æ„å»ºé¡¹ç›®

---

## ğŸ“ è®¿é—®åœ°å€

### Ubuntu/Linux éƒ¨ç½²

- **å‰ç«¯åœ°å€**: `http://æœåŠ¡å™¨IP:8088/`
- **åç«¯API**: `http://æœåŠ¡å™¨IP:3001/`

ä¾‹å¦‚ï¼š`http://10.8.9.208:8088/`

### Windows å¼€å‘ç¯å¢ƒ

- **å‰ç«¯åœ°å€**: `http://localhost:6719`
- **åç«¯API**: `http://localhost:3001`

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### Ubuntu/Linux

```bash
# æŸ¥çœ‹åç«¯å®æ—¶æ—¥å¿—
pm2 logs log-lottery-backend

# æŸ¥çœ‹åç«¯çŠ¶æ€
pm2 status

# æŸ¥çœ‹åç«¯è¯¦ç»†ä¿¡æ¯
pm2 show log-lottery-backend

# æŸ¥çœ‹åç«¯æ—¥å¿—
sudo tail -f /var/log/nginx/access.log

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# æµ‹è¯• Nginx é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½ Nginx é…ç½®
sudo systemctl reload nginx

# é‡å¯ Nginx
sudo systemctl restart nginx

# æŸ¥çœ‹ Nginx çŠ¶æ€
sudo systemctl status nginx
```

### Windows

```bash
# æŸ¥çœ‹ node è¿›ç¨‹
tasklist | findstr "node.exe"

# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr ":3001"

# ç»“æŸè¿›ç¨‹
taskkill /PID <è¿›ç¨‹ID> /F

# æŸ¥çœ‹ PM2 çŠ¶æ€
pm2 status

# æŸ¥çœ‹ PM2 æ—¥å¿—
pm2 logs log-lottery-backend

# å¼€å‘æœåŠ¡å™¨è¿è¡Œ
npm run dev:fe

# åç«¯æœåŠ¡å™¨è¿è¡Œ
node server.cjs

# åŒæ—¶è¿è¡Œå‰åç«¯
npm run dev:all
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### Ubuntu/Linux

1. **æƒé™é—®é¢˜**
   ```bash
   # éœ€è¦ä½¿ç”¨ sudo çš„æ“ä½œä¼šè‡ªåŠ¨è¯·æ±‚æƒé™
   # ç¡®ä¿ sudo å¯†ç å·²è®¾ç½®
   ```

2. **é˜²ç«å¢™è®¾ç½®**
   ```bash
   # ç¡®ä¿é˜²ç«å¢™å¼€æ”¾ç«¯å£
   sudo ufw allow 8088/tcp
   sudo ufw allow 3001/tcp
   ```

3. **PM2 å¼€æœºè‡ªå¯**
   ```bash
   # è®¾ç½® PM2 å¼€æœºè‡ªå¯
   pm2 startup
   pm2 save
   ```

4. **Nginx é…ç½®**
   ```bash
   # é…ç½®æ–‡ä»¶ä½ç½®
   /etc/nginx/sites-available/log-lottery
   ```

### Windows

1. **ç«¯å£å ç”¨**
   - å¦‚æœç«¯å£è¢«å ç”¨ï¼Œè¯·ä½¿ç”¨ `netstat -ano | findstr ":ç«¯å£å·"` æŸ¥çœ‹å ç”¨è¿›ç¨‹
   - ä½¿ç”¨ `taskkill /PID <è¿›ç¨‹ID> /F` ç»“æŸè¿›ç¨‹

2. **ä¾èµ–é—®é¢˜**
   - é¦–æ¬¡è¿è¡Œè¯·å…ˆæ‰§è¡Œ `npm install --legacy-peer-deps`

3. **PM2 å®‰è£…**
   ```bash
   # å…¨å±€å®‰è£… PM2
   npm install -g pm2
   ```

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1: ç«¯å£è¢«å ç”¨

**Ubuntu/Linux:**
```bash
# æŸ¥çœ‹å ç”¨è¿›ç¨‹
sudo lsof -i :3001

# ç»“æŸè¿›ç¨‹
sudo kill -9 <PID>
```

**Windows:**
```bash
# æŸ¥çœ‹å ç”¨è¿›ç¨‹
netstat -ano | findstr ":3001"

# ç»“æŸè¿›ç¨‹
taskkill /PID <PID> /F
```

### é—®é¢˜2: Nginx å¯åŠ¨å¤±è´¥

```bash
# æ£€æŸ¥é…ç½®
sudo nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload nginx
```

### é—®é¢˜3: PM2 æœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹æ—¥å¿—
pm2 logs log-lottery-backend

# æŸ¥çœ‹é”™è¯¯
pm2 show log-lottery-backend

# é‡æ–°å¯åŠ¨
pm2 restart log-lottery-backend
```

### é—®é¢˜4: å‰ç«¯ç©ºç™½é¡µ

**Ubuntu/Linux:**
```bash
# æ£€æŸ¥æ„å»ºæ–‡ä»¶
ls -la /var/www/log-lottery/

# æ£€æŸ¥æƒé™
sudo chown -R www-data:www-data /var/www/log-lottery
sudo chmod -R 755 /var/www/log-lottery

# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t
```

**Windows:**
- æ£€æŸ¥æ˜¯å¦æ­£ç¡®æ‰§è¡Œäº† `npm run build`
- æ£€æŸ¥ `dist` æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åé‡è¯•

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-12-30)
- åˆ›å»º Ubuntu/Linux æœåŠ¡ç®¡ç†è„šæœ¬ (server.sh)
- åˆ›å»º Windows æœåŠ¡ç®¡ç†è„šæœ¬ (server.bat)
- æ”¯æŒå¯åŠ¨/åœæ­¢/é‡å¯æœåŠ¡
- æ”¯æŒæŸ¥çœ‹æœåŠ¡çŠ¶æ€å’Œæ—¥å¿—
- æ”¯æŒä¸€é”®é‡æ–°éƒ¨ç½²

---

## ğŸ’¡ æç¤º

- é¦–æ¬¡ä½¿ç”¨ Ubuntu è„šæœ¬éœ€è¦ `chmod +x server.sh` èµ‹äºˆæ‰§è¡Œæƒé™
- å»ºè®®å®šæœŸå¤‡ä»½ `public/templates` å’Œ `public/fonts` æ–‡ä»¶å¤¹
- ç”Ÿäº§ç¯å¢ƒå»ºè®®é…ç½® HTTPS
- ä½¿ç”¨ PM2 ç®¡ç†åç«¯æœåŠ¡å¯ä»¥æ›´å¥½åœ°ç›‘æ§å’Œè‡ªåŠ¨é‡å¯

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æœåŠ¡çŠ¶æ€ï¼š`./server.sh status` æˆ– `server.bat`
2. æ—¥å¿—ä¿¡æ¯ï¼š`./server.sh logs` æˆ–æŸ¥çœ‹æ—¥å¿—é€‰é¡¹
3. ç«¯å£å ç”¨æƒ…å†µ
4. é˜²ç«å¢™è®¾ç½®

---

**ç‰ˆæœ¬**: v1.0.0
**æ›´æ–°æ—¶é—´**: 2024å¹´12æœˆ30æ—¥
**é€‚ç”¨ç³»ç»Ÿ**: Ubuntu 18.04+ / Windows 10+
