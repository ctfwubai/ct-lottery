# 移动端控制功能测试清单

## 测试环境准备

### 1. 服务器状态检查
- [ ] 后端服务器运行正常（端口 3001）
- [ ] 前端开发服务器运行正常（端口 5173）
- [ ] WebSocket 服务已启动
- [ ] 日志目录已创建（logs/mobile-control.log）

### 2. 配置检查
- [ ] 默认验证码：`123456`
- [ ] 默认管理员密码：从 `LOGIN_CONFIG.md` 读取
- [ ] 移动端控制功能已启用

## 功能测试

### 一、大屏端测试

#### 1.1 首页显示
- [ ] 右上角显示锁图标（🔓/🔒）
- [ ] 锁图标点击正常
- [ ] 锁图标样式正常（绿色解锁/红色锁定）

#### 1.2 二维码功能
- [ ] 鼠标悬停在"开始抽奖"按钮上显示二维码
- [ ] 二维码内容正确（包含完整的移动端控制URL）
- [ ] 二维码可以正常扫描
- [ ] 二维码对话框关闭按钮工作正常

#### 1.3 锁定/解锁功能
- [ ] 点击解锁图标（🔓）直接锁定
- [ ] 锁定后图标变为 🔒
- [ ] 点击锁定图标（🔒）弹出解锁对话框
- [ ] 解锁对话框显示正确的提示信息
- [ ] 输入正确密码可以解锁
- [ ] 输入错误密码提示错误信息
- [ ] 取消解锁对话框正常关闭

#### 1.4 状态管理
- [ ] 进入抽奖页面时，`isInLotteryPage` 设置为 true
- [ ] 离开抽奖页面时，`isInLotteryPage` 设置为 false
- [ ] WebSocket 连接自动建立
- [ ] WebSocket 断线后自动重连（3秒后）

### 二、配置页面测试

#### 2.1 总开关
- [ ] 总开关默认状态为开启
- [ ] 可以切换总开关状态
- [ ] 切换开关需要管理员密码
- [ ] 关闭开关后移动端无法连接
- [ ] 开启开关后移动端可以连接

#### 2.2 验证码设置
- [ ] 默认验证码显示为 `●●●●●●`
- [ ] 点击"更新验证码"显示输入框
- [ ] 可以输入新的验证码（4-8位数字）
- [ ] 验证码格式验证正常（非4-8位数字拒绝）
- [ ] 更新验证码需要管理员密码
- [ ] 更新成功后验证码立即生效

#### 2.3 连接状态
- [ ] 显示当前连接状态（已连接/未连接）
- [ ] 连接状态实时更新

#### 2.4 操作日志
- [ ] 日志列表正常显示
- [ ] 日志按时间倒序排列
- [ ] 可以查看/收起日志
- [ ] 清空日志需要管理员密码
- [ ] 清空日志后列表为空

### 三、移动端登录测试

#### 3.1 登录页面
- [ ] 访问 `/mobile-control` 显示登录页面
- [ ] 页面样式正常（渐变背景、卡片布局）
- [ ] Logo 和标题显示正常
- [ ] 提示信息显示正确

#### 3.2 验证码验证
- [ ] 输入框默认为数字键盘
- [ ] 最多输入8位数字
- [ ] 输入正确验证码登录成功
- [ ] 输入错误验证码显示错误提示
- [ ] 格式不正确（非4-8位数字）显示错误提示
- [ ] 空验证码无法提交

#### 3.3 功能开关检查
- [ ] 如果移动端控制已关闭，显示错误并跳转首页
- [ ] 网络错误时显示错误提示

#### 3.4 登录成功
- [ ] 登录成功后显示成功提示
- [ ] 自动跳转到控制面板
- [ ] 生成设备ID

### 四、移动端控制面板测试

#### 4.1 控制面板显示
- [ ] 标题和设备名称显示正常
- [ ] 大屏状态卡片显示正常
- [ ] 状态指示灯显示正确（绿色=可控制，红色=不可控制）
- [ ] 控制按钮显示正常

#### 4.2 状态显示
- [ ] "可以控制"：大屏未锁定 + 在抽奖页面
- [ ] "大屏已锁定"：大屏已锁定
- [ ] "大屏不在抽奖界面"：不在抽奖页面
- [ ] 状态轮询正常（每2秒）

#### 4.3 控制功能
- [ ] "开始抽奖"按钮在可控制状态下可用
- [ ] "开始抽奖"按钮在不可控制状态下禁用
- [ ] 点击"开始抽奖"发送指令成功
- [ ] "停止抽奖"按钮在可控制状态下可用
- [ ] "停止抽奖"按钮在不可控制状态下禁用
- [ ] 点击"停止抽奖"发送指令成功

#### 4.4 退出登录
- [ ] 点击"退出登录"显示确认对话框
- [ ] 确认后跳转回登录页面
- [ ] 取消退出保留在当前页面

### 五、WebSocket 通信测试

#### 5.1 连接管理
- [ ] 大屏自动连接 WebSocket
- [ ] 连接成功后显示日志
- [ ] 断线后自动重连
- [ ] 重连成功后恢复功能

#### 5.2 消息传递
- [ ] 大屏发送状态消息
- [ ] 大屏接收开始抽奖消息
- [ ] 大屏接收停止抽奖消息
- [ ] 移动端连接消息
- [ ] 移动端断开连接消息

#### 5.3 心跳检测
- [ ] 心跳检测正常（30秒）
- [ ] 超时自动断开连接
- [ ] 断开后清理状态

### 六、API 测试

#### 6.1 验证码相关
- [ ] `GET /api/mobile-control/code` - 获取验证码
- [ ] `PUT /api/mobile-control/code` - 更新验证码
- [ ] `POST /api/mobile-control/verify` - 验证验证码

#### 6.2 控制相关
- [ ] `GET /api/mobile-control/status` - 获取状态
- [ ] `POST /api/mobile-control/start` - 开始抽奖
- [ ] `POST /api/mobile-control/stop` - 停止抽奖
- [ ] `POST /api/mobile-control/lock` - 锁定/解锁

#### 6.3 配置相关
- [ ] `GET /api/mobile-control/enabled` - 获取总开关状态
- [ ] `PUT /api/mobile-control/enabled` - 切换总开关

#### 6.4 日志相关
- [ ] `GET /api/mobile-control/logs` - 获取日志
- [ ] `DELETE /api/mobile-control/logs` - 清空日志

### 七、安全测试

#### 7.1 权限验证
- [ ] 未登录无法修改验证码
- [ ] 未登录无法切换总开关
- [ ] 未登录无法清空日志
- [ ] 未登录无法锁定/解锁大屏
- [ ] 管理员密码错误拒绝操作

#### 7.2 单设备限制
- [ ] 同时只能连接一个设备
- [ ] 新设备连接时拒绝已连接的设备
- [ ] 设备断开后其他设备可以连接

#### 7.3 状态验证
- [ ] 功能关闭时无法连接
- [ ] 大屏锁定时无法控制
- [ ] 不在抽奖页面时无法控制

### 八、日志记录测试

#### 8.1 日志内容
- [ ] 记录所有验证码验证操作
- [ ] 记录所有控制操作（开始/停止抽奖）
- [ ] 记录所有配置更改（验证码、总开关）
- [ ] 记录所有设备连接/断开
- [ ] 记录所有错误操作
- [ ] 包含时间戳、操作类型、设备、结果

#### 8.2 日志格式
- [ ] 日志格式：`[时间] [操作] [设备] 结果 {额外信息}`
- [ ] JSON 格式额外信息
- [ ] 日志按时间追加到文件
- [ ] 日志文件自动创建

### 九、异常处理测试

#### 9.1 网络错误
- [ ] 网络断开时显示错误提示
- [ ] API 请求失败时显示错误提示
- [ ] WebSocket 连接失败时尝试重连

#### 9.2 数据错误
- [ ] 格式错误的验证码拒绝
- [ ] 缺少参数的请求拒绝
- [ ] 无效的操作拒绝

#### 9.3 并发测试
- [ ] 多个设备同时连接时只接受第一个
- [ ] 快速点击控制按钮时不会重复发送

### 十、UI/UX 测试

#### 10.1 响应式设计
- [ ] 桌面端显示正常
- [ ] 平板端显示正常
- [ ] 手机端显示正常
- [ ] 不同分辨率适配正常

#### 10.2 用户体验
- [ ] 加载状态显示正常
- [ ] 错误提示清晰明确
- [ ] 成功提示及时反馈
- [ ] 按钮禁用状态明显
- [ ] 动画效果流畅

## 性能测试

- [ ] 页面加载时间 < 2秒
- [ ] API 响应时间 < 500ms
- [ ] WebSocket 消息延迟 < 100ms
- [ ] 轮询间隔合理（2秒）
- [ ] 心跳检测合理（30秒）

## 兼容性测试

### 浏览器兼容性
- [ ] Chrome（最新版）
- [ ] Firefox（最新版）
- [ ] Safari（最新版）
- [ ] Edge（最新版）

### 设备兼容性
- [ ] iPhone
- [ ] iPad
- [ ] Android 手机
- [ ] Android 平板

## 集成测试场景

### 场景1：正常使用流程
1. 大屏进入抽奖页面
2. 移动端扫描二维码
3. 移动端输入验证码登录
4. 移动端查看状态为"可以控制"
5. 移动端点击"开始抽奖"
6. 大屏开始抽奖
7. 移动端点击"停止抽奖"
8. 大屏停止抽奖
9. 移动端退出登录

### 场景2：锁定状态
1. 大屏点击锁定
2. 移动端登录
3. 移动端查看状态为"大屏已锁定"
4. 移动端控制按钮禁用
5. 大屏输入密码解锁
6. 移动端状态更新为"可以控制"
7. 移动端控制按钮启用

### 场景3：不在抽奖页面
1. 大屏在配置页面
2. 移动端登录
3. 移动端查看状态为"大屏不在抽奖界面"
4. 移动端控制按钮禁用
5. 大屏进入抽奖页面
6. 移动端状态更新为"可以控制"

### 场景4：功能关闭
1. 配置页面关闭移动端控制
2. 移动端访问登录页面
3. 显示"功能已关闭"错误
4. 自动跳转回首页

### 场景5：网络断开重连
1. 移动端登录并连接
2. 大屏网络断开
3. 移动端状态显示错误
4. 大屏网络恢复
5. 自动重连成功
6. 功能恢复正常

### 场景6：验证码错误
1. 移动端输入错误验证码
2. 显示"验证码错误"提示
3. 输入正确验证码
4. 登录成功

## 测试工具

### 自动化测试
使用 `test-mobile-control.html` 进行自动化测试：
```bash
# 在浏览器中打开
open test-mobile-control.html

# 或者使用本地服务器访问
http://localhost:5173/test-mobile-control.html
```

### 手动测试
1. 大屏测试：访问 `http://localhost:5173`
2. 移动端测试：访问 `http://localhost:5173/mobile-control`
3. 配置页面：访问 `http://localhost:5173` → 配置 → 移动端控制设置

## 已知问题

无

## 测试结论

- [ ] 所有测试通过
- [ ] 部分测试通过
- [ ] 需要修复

备注：
