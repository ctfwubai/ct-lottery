# 手机控制操作日志说明

## 日志位置
日志文件存储在: `logs/mobile-control.log`

## 日志格式
日志采用CSV格式,可以直接用Excel打开,格式为:
```
"时间","设备名","IP地址","操作类型","结果","额外信息"
```

## 记录的信息
每条日志包含以下信息:
- **时间**: 精确到秒的时间戳
- **设备名**: 手机连接时输入的设备名称(如"Android"、"iPhone"等)
- **IP地址**: 手机的IP地址
- **操作类型**: 执行的操作(如开始抽奖、停止抽奖等)
- **结果**: 操作结果(success/failed)
- **额外信息**: 操作相关的额外数据(如中奖人员ID、中奖人员姓名等)

## 操作类型说明

| 操作类型 | 说明 |
|---------|------|
| 设备连接 | 手机成功连接到服务器 |
| 设备断开 | 手机从服务器断开连接 |
| 开始抽奖 | 手机点击"开始抽奖"按钮 |
| 停止抽奖 | 手机点击"停止抽奖"按钮 |
| 继续抽奖 | 手机点击"继续抽奖"按钮 |
| 查看中奖名单 | 手机点击"查看中奖名单"按钮 |
| 跳过中奖人员 | 手机点击"跳过"按钮跳过某个中奖人员 |
| 锁定控制 | 大屏或管理员锁定/解锁手机控制 |
| 切换功能开关 | 开启/关闭手机控制功能 |
| 更新验证码 | 管理员更新手机连接验证码 |
| 验证码验证 | 手机输入验证码进行验证 |
| 清空日志 | 管理员清空操作日志 |

## 查看日志

### 方法1: 用Excel打开(推荐)
1. 找到 `logs/mobile-control.log` 文件
2. 右键点击文件,选择"打开方式" → "Microsoft Excel"
3. Excel会自动识别CSV格式并按列显示

### 方法2: 用WPS打开
1. 找到 `logs/mobile-control.log` 文件
2. 右键点击文件,选择"打开方式" → "WPS表格"
3. WPS会自动识别CSV格式并按列显示

### 方法3: 命令行查看
```bash
# 查看最新的20条日志(Windows PowerShell)
Get-Content logs/mobile-control.log -Tail 20

# 实时查看日志(Windows PowerShell)
Get-Content logs/mobile-control.log -Wait -Tail 20

# 查看日志(Linux/Mac)
cat logs/mobile-control.log

# 实时查看日志(Linux/Mac)
tail -f logs/mobile-control.log
```

### 方法4: 在手机控制界面查看
在【全局配置】-【手机控制】页面中,点击"查看日志"按钮可以查看操作日志

## 日志示例

### 表头(第一行)
```
"时间","设备名","IP地址","操作类型","结果","额外信息"
```

### 设备连接
```
"2026-01-04 08:15:36","Android","10.8.4.91","设备连接","success",""
```

### 开始抽奖
```
"2026-01-04 14:31:05","Android","10.8.4.91","开始抽奖","success",""
```

### 停止抽奖
```
"2026-01-04 14:31:15","Android","10.8.4.91","停止抽奖","success",""
```

### 继续抽奖
```
"2026-01-04 14:31:20","Android","10.8.4.91","继续抽奖","success",""
```

### 查看中奖名单
```
"2026-01-04 14:32:00","Android","10.8.4.91","查看中奖名单","success",""
```

### 跳过中奖人员
```
"2026-01-04 14:33:15","Android","10.8.4.91","跳过中奖人员","success",""winnerId: 123, winnerName: 张三""
```

### 设备断开
```
"2026-01-04 15:00:00","Android","10.8.4.91","设备断开","success",""reason: connection_closed""
```

## MAC地址说明
由于浏览器安全限制,JavaScript无法直接获取设备的MAC地址。因此日志中只记录了:
- **设备名**: 手机连接时输入的设备名称(如"Android"、"iPhone"等)
- **IP地址**: 手机的IP地址(如"10.8.4.91")

如果需要MAC地址,可以通过以下方式获取:
1. 查看路由器的DHCP客户端列表,根据IP地址查找对应的MAC地址
2. 使用网络扫描工具(如Advanced IP Scanner、Angry IP Scanner等)
3. 在路由器管理界面中查看"已连接设备"列表

## 注意事项
- 日志采用CSV格式,可以直接用Excel或WPS打开
- 清空日志会在手机控制配置界面中点击"清空日志"按钮,清空后会自动添加表头
- 日志格式会根据版本更新而调整
- 如果CSV文件在Excel中显示乱码,可以尝试:
  - 使用"数据" → "从文本/CSV导入"功能,选择UTF-8编码
  - 或者用记事本打开,另存为ANSI编码格式
